" Tridactyl configuration file.
" Nefari0uss.

" File location: $XDG_CONFIG_DIR/tridactyl/tridactylrc.
" This file assumes that `:nativeinstall` has been run.

" Reset local Tridactyl settings to defaults.
sanitize tridactyllocal tridactylsync

" General settings.

" General keybindings and helpers.
set allowautofocus false
set auconcreatecontainer false
set completions.Tab.statusstylepretty true
set configversion 2.0
set containerindicator true
set cursorpos end
set downloadsskiphistory false
set findcase smart
set findhighlighttimeout 3000
set hintautoselect true
set hintchars hjklasdfgyuiopqwertnmzxcvb
set hintdelay 300
set hintfiltermode vimperator-reflow
set hintnames numeric
set modeindicator true
set modeindicatorshowkeys true
set preventautofocusjackhammer false
set smoothscroll true
set tabclosepinned false
set tabopencontaineraware false
set tabopenpos related
set tabshowhidden true
set tabsort default
set theme midnight
set urlparenttrailingslash true
set visualenterauto true
set visualexitauto true

" These binds make navigation and tab management faster.
bind d composite tab #; tabclose #
bind J tabprev
bind K tabnext
bind H back
bind L forward
bind u undo tab
bind U undo window
bind y clipboard yankshort
bind B fillcmdline bmarks
bind j scrolline 5
bind k scrolline -5

" Page navigation helpers.
bind ge followpage prev
bind gn followpage next

" Clipboard and yank helpers.
bind gd tabdetach
bind gD composite tabduplicate; tabdetach
bind yy clipboard yankcanon
bind ;c hint -Jc [class*="expand"],[class="togg"],[class="comment_folder"]
command hint_focus hint -;
bind ;C composite hint_focus; !s xdotool key Menu

" Bindings for reader and navigation modes.
bind gr reader
bind gR reader --tab

" URL-specific hint rules and redirects.
" These rules limit hinting to relevant elements and rewrite inconvenient URLs.
bindurl youtu((\.be)|(be\.com)) f hint -J
bindurl youtu((\.be)|(be\.com)) F hint -b -J
bindurl youtu((\.be)|(be\.com)) tf hint -t -J
bindurl wikiwand.com yy composite js document.location.href.replace("wikiwand.com/en","wikipedia.org/wiki") | clipboard yank
bindurl ^https://duckduckgo.com f hint -Jc [class=result__a]
bindurl ^https://duckduckgo.com F hint -Jbc [class=result__a]
bindurl www.google.com f hint -Jc #search div:not(.action-menu) > a
bindurl www.google.com F hint -Jbc #search div:not(.action-menu) > a

bindurl reddit.com gu urlparent 4
bindurl reddit.com <Space><Space> urlmodify -t www old
autocmd DocStart ^http(s?)://www.reddit.com js tri.excmds.urlmodify("-t", "www", "old")

" Focus and autofocus preferences.
setpref browser.autofocus false
seturl .*github.com preventautofocusjackhammer false

" Search and find bindings.
unbind <C-f>
bind / fillcmdline find
bind ? fillcmdline find -?
bind n findnext 1
bind N findnext -1
bind ,<Space> nohlsearch

" Quickmarks and bookmarks.
quickmark G https://gist.github.com/Nefari0uss
quickmark c https://calendar.google.com/calendar/u/0/r
quickmark d https://github.com/Nefari0uss/dotfiles
quickmark g https://github.com/
quickmark i https://www.inoreader.com/
quickmark l https://lolesports.com/
quickmark m https://mail.google.com/mail/u/0/#inbox
quickmark n https://www.github.com/Nefari0uss
quickmark r https://www.reddit.com/
quickmark s https://store.steampowered.com/
quickmark y https://www.youtube.com/

" Blacklist sites where Tridactyl should not run.
blacklistadd calendar.google.com
blacklistadd docs.google.com
blacklistadd drive.google.com
blacklistadd keep.google.com
blacklistadd mail.google.com
blacklistadd youtube.com

" Browser-specific preferences.
set urlparenttrailingslash true

" Browser maps.
set browsermaps {
    "<A-6>": "buffer #",
    "<C-,>": "escapehatch",
    "<CS-6>": "tab #",
    "<CS-;>": "fillcmdline_notrail"
}

" Search engine quicklinks.
set searchurls.amz https://www.amazon.com/s?field-keywords=%s
set searchurls.archive https://web.archive.org/web/*/%s
set searchurls.d https://duckduckgo.com/?q=%s
set searchurls.ddg https://duckduckgo.com/html?q=%s
set searchurls.g https://www.google.com/search?q=%s
set searchurls.gh https://github.com/search?q=%s
set searchurls.gi https://www.google.com/images/search?q=%s
set searchurls.map https://www.google.com/maps/search/%s
set searchurls.mdn https://developer.mozilla.org/en-US/search?q=%s
set searchurls.node https://nodejs.org/dist/latest/docs/api/
set searchurls.npm https://www.npmjs.com/search?q=%s
set searchurls.protondb https://www.protondb.com/search?q=
set searchurls.r https://old.reddit.com/r/%s
set searchurls.steam https://store.steampowered.com/search/?term=%s
set searchurls.w https://en.wikipedia.org/w/index.php?search=%s
set searchurls.yt https://www.youtube.com/results?search_query=%s

" Disable all previous custom searchurls before setting new ones.
jsb Object.keys(tri.config.get("searchurls")).reduce((prev, u) => prev.catch(()=>{}).then(_ => tri.excmds.setnull("searchurls." + u)), Promise.resolve())

" Redirects and site-specific ignores.
autocmd DocStart mail.google.com mode ignore
" autocmd DocStart github.com mode ignore
autocmd DocStart gitlab.com mode ignore
