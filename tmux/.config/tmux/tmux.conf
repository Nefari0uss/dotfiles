# tmux.conf
# Nefari0uss

#region --- Reference ---

# ---set vs setw vs setg ---
# set (set-option): Controls the global/session/server options.
# setw (set-window-option): Controls the window specific options.
# setg (set-option -g): Sets the option globally for the server (all sessions).

# --- Command Flags ---
# -g: Global scope (applies to all sessions or windows).
# -w: Apples to the existing value rather than replacing it.
# -s: Server option (applies to the tmux server itself).
# -u: Unset an option (reset to default).
# -q: Quiet mode (suppress output). Will not throw an error if flag doesn't exist.
# Use `tmux list-commands` to inspect available commands and flags.

# --- Binding Flags ---
# -c: Command to run (for `run-shell` bindings).
# -n: No prefix key (bind without prefix).
# -r: Make the key repeatable when held down.
# -t: Apply the binding to a specific target.
# -N: Adds a note/annotation to the key binding.
# -T: Bind to a specific key-table (e.g. copy-mode-vi).

# --- Window / Pane Flags ---
# -c <path> : start new window/pane in <path>
# -d: Detached mode (doesn't attach to the new window/pane).
# -h/v: Horizontal/Vertical split (for `split-window`).
# -p: Percentage (for size specification).
# -F: Format (for specifying format strings).
# -P: print the new pane id after creation.

# --- bind vs bind-key ---
# `bind` is an alias for `bind-key` in modern tmux versions. They are equivalent.
# Use `bind-key -T <table> <key> ...` to bind keys to specific key-tables.

# --- Special Key Combinations ---
# Control (e.g. C-a is Ctrl+a)
# Alt/Meta (e.g. M-j is Alt+j)
# Shift (e.g. S-<something>)
#   Letters: use the uppercase letter directly (e.g. S-A is Shift+a).
#   Named keys: use the S- prefix (e.g. S-Left is Shift+Left Arrow).
#   Symbols: Use the symbol directly (e.g. !, @, #, etc.).
# Arrow keys: Use 'Left', 'Right', 'Up', 'Down'.
# Backspace: Use 'BSpace'.
# Enter/Return: Use 'Enter'.
# Escape: Use 'Escape' or 'Esc'.
# Function keys: 'F1', 'F2', etc.
# Home/End: Use 'Home' and 'End'.
# Page Up/Down: Use 'PageUp' and 'PageDown'.
# Space: Use 'Space'.
# Tab: Use 'Tab' or 'BTab' for Shift+Tab.

# --- Other ---
# <Prefix> S-C will bring up a list of all options and their current values.

# Quick reference commands:
#   tmux list-keys                  # list current key bindings
#   tmux list-commands              # list available tmux commands
#   tmux show-options -g            # show global options
#   tmux show-window-options -wg   # show window options (global and local)
#   tmux display-message -p "#{session_name}:#{window_index}.#{pane_index}"  # show context info

# Useful format strings:
#   #{session_name}  #{window_index}  #{pane_index}  #{pane_current_path}  #{pane_title}

# Example: common patterns
#   bind r command-prompt -I "#{session_name}" "rename-session \"%%\""
#   bind c new-window -c "#{pane_current_path}"

#endregion

# TODO: Theme

#region --- General Settings ---

set-option -g default-shell /bin/zsh            # Use zsh as default shell.
set -g default-terminal "screen-256color"      # Enable better color support.
set-option -g detach-on-destroy off             # Do not kill tmux on session destroy.
set -g history-limit 20000                      # Set history scrollback limit.
set -sg escape-time 5                           # Address vim mode switching delay.
set -g buffer-limit 20                          # Set buffer limit.
set -g repeat-time 300                          # Time to wait in ms between repeating keys.
set -g set-clipboard on                         # Enable clipboard integration.

# Yazi Image Preview: https://yazi-rs.github.io/docs/image-preview/#tmux
set -g allow-passthrough on # Allow passthrough of unknown escape sequences.
set -ga update-environment TERM # Ensure TERM is updated in tmux environment.
set -ga update-environment TERM_PROGRAM # Ensure TERM_PROGRAM is updated in tmux environment.

#endregion

#region --- Activity Messages ---

set -g bell-action any     # Listen to alerts from all windows.
set -g monitor-bell on     # Notice bell in windows.
set -g visual-activity on  # Send bell *and* notify when activity occurs.
set -g monitor-activity on # Monitor activity in windows.
set -g visual-bell off     # Disable visual bell (flash).
set -g visual-silence both # Disable visual indication for silence and bell.
set -g focus-events on     # Enable terminal focus events if supported.
set -g display-time 1500   # Display messages for 1.5s. Default is 750 ms.

#endregion

#region --- Window & Pane Options ---

setw -g allow-rename off                        # Window name should not follow last command.
set -g base-index 1                             # Start window index at 1.
set -g pane-base-index 1                         # Start pane index at 1 (server-global).
set -g renumber-windows on                      # Renumber windows when one is closed.
set -g set-titles on                            # Allow tmux to set terminal title.
set -g set-titles-string "#I:#W" # The title will be <index>:<window-name>
setw -g aggressive-resize off # Do *not* aggressively resize panes to the smallest client.
set -g remain-on-exit off                       # Don't keep panes open after process exit.
setw -g automatic-rename on                        # Disable automatic window renaming.
default_pane_resize=5 # Default pane resize amount.
set -g pane-border-status top # Show pane borders at the top.
set -g pane-border-format "#P: #{pane_current_command}" # Show <pane-index>: <command> in the border.
set -g window-status-current-style "underscore"

#endregion

#region --- Mouse ---

set -g mouse on                                 # Enable mouse support for panes and selection.

# Scroll up/down with the mouse wheel.
bind -T root WheelUpPane   if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; copy-mode -e; send-keys -M"
bind -T root WheelDownPane if-shell -F -t = "#{alternate_on}" "send-keys -M" "select-pane -t =; send-keys -M"

# Scroll up/down an entire page.
# bind -t vi-copy    WheelUpPane   page-up
# bind -t vi-copy    WheelDownPane page-down
# bind -t emacs-copy WheelUpPane   page-up
# bind -t emacs-copy WheelDownPane page-down

unbind -T copy-mode-vi MouseDragEnd1Pane # Do not exit copy mode after mouse drag.

#endregion

#region --- Keybindings ---
set -g extended-keys on # Enable support for extended keys (e.g. Alt+Arrow, Shift+Arrow).
setw -g mode-keys vi # Use vim keybindings.

# Move between panes with <C-h/j/k/l>. Does not require prefix.
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Use <C-S-L/D/U/R> to resize panes. Does not require prefix.
# bind -n C-S-h resize-pane -L 5
# bind -n C-S-j resize-pane -D 5
# bind -n C-S-k resize-pane -U 5
# bind -n C-S-l resize-pane -R 5
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Copy & paste using vim keybindings.
unbind V
bind V copy-mode
unbind p
bind p paste-buffer
bind-key -T copy-mode-vi 'V' send -X begin-selection # Visually select with "V".
bind-key -T copy-mode-vi 'y' send -X copy-selection # Copy with "y".

# Reload tmux configuration
unbind r
bind r source-file $HOME/.config/tmux/tmux.conf \; display "Tmux config reloaded."

# Rename session and window
# bind r command-prompt -I "#{window_name}" "rename-window "%%""
# bind R command-prompt -I "#{session_name}" "rename-session "%%""

# Window splits.
unbind '"'
unbind %
unbind v
unbind h
bind v split-window -hc "#{pane_current_path}" # Split vertically, inheriting cwd.
bind h split-window -vc "#{pane_current_path}" # Split horizontally, inheriting cwd.

bind c new-window -c "#{pane_current_path}" # Create new window, inheriting cwd.

# Goto a mark
# bind \` switch-client -t"{marked}"

# Window Navigation
bind -n C-p previous-window # Without prefix, jump to previous window.
bind -n C-n next-window # Without prefix, jump to next window.
bind Space last-window # Jump to previous window.

# Swap window (index).
bind -r "<" swap-window -d -t -1 # Swap with window index -1.
bind -r ">" swap-window -d -t +1 # Swap with window index +1.


#endregion

#region --- Colors ---

#endregion

#region --- Status Bar ---

set -g status-interval 15 # Update status bar every 15 seconds.

#endregion

#region --- Plugins ---

set -g @plugin 'tmux-plugins/tpm' # https://github.com/tmux-plugins/tpm/
set -g @plugin 'sainnhe/tmux-fzf' # https://github.com/sainnhe/tmux-fzf
set -g @plugin 'noscript/tmux-mighty-scroll' # https://github.com/noscript/tmux-mighty-scroll
set -g @plugin 'joshmedeski/tmux-nerd-font-window-name' # https://github.com/joshmedeski/tmux-nerd-font-window-name
# set -g @plugin 'alexwforsythe/tmux-which-key' # https://github.com/alexwforsythe/tmux-which-key
# set -g @plugin 'ofirgall/tmux-window-name' # https://github.com/ofirgall/tmux-window-name
# set -g @plugin 'joshmedeski/sesh' # https://github.com/joshmedeski/sesh

set -g @tmux_mode_indicator_normal_mode_text "NORMAL"
set -g @tmux_mode_indicator_insert_mode_text "INSERT"
set -g @tmux_mode_indicator_prefix_pressed_text "PREFIX"
set -g @tmux_mode_indicator_copy_mode_text "COPY"
set -g @tmux_mode_indicator_separator "âœ¤"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.config/tmux/plugins/tpm/tpm"

#endregion
